<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Learning System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-dark: #0f172a; --bg-card: rgba(30, 41, 59, 0.7); --primary: #6366f1; --accent: #06b6d4; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; --text-main: #f8fafc; --text-muted: #94a3b8; --glass-border: rgba(255, 255, 255, 0.08); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%); background-attachment: fixed; min-height: 100vh; color: var(--text-main); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* Navbar & Container */
        .navbar { width: 100%; max-width: 1200px; background: var(--bg-card); backdrop-filter: blur(16px); padding: 15px 30px; margin-bottom: 40px; border-radius: 16px; border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between; }
        .navbar-brand { display: flex; align-items: center; gap: 15px; }
        .navbar-brand img { height: 40px; border-radius: 8px; }
        .navbar span { font-family: 'Outfit', sans-serif; font-size: 24px; font-weight: 700; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .container { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        
        /* Cards */
        .card-style { background: var(--bg-card); backdrop-filter: blur(16px); border-radius: 24px; padding: 30px; border: 1px solid var(--glass-border); box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        
        /* Quiz UI */
        .quiz-header { text-align: center; margin-bottom: 30px; }
        .quiz-title { font-family: 'Outfit', sans-serif; font-size: 32px; font-weight: 700; display: flex; justify-content: center; gap: 15px; }
        .quiz-subtitle { color: var(--text-muted); font-size: 16px; font-weight: 300; }
        .meta-info { display: flex; justify-content: space-between; margin-bottom: 25px; }
        .timer { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; padding: 8px 20px; border-radius: 50px; font-weight: 600; border: 1px solid rgba(99, 102, 241, 0.3); }
        .timer.warning { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border-color: rgba(239, 68, 68, 0.4); animation: pulse 1s infinite; }
        .question { font-family: 'Outfit', sans-serif; font-size: 26px; margin-bottom: 30px; font-weight: 500; }
        
        /* Options & Buttons */
        .option { background: rgba(255, 255, 255, 0.03); padding: 18px 25px; border: 1px solid var(--glass-border); border-radius: 16px; margin-bottom: 15px; cursor: pointer; transition: all 0.2s; }
        .option:hover:not(.disabled) { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); }
        .option.selected { background: linear-gradient(90deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.05) 100%); border-color: var(--primary); }
        .option.disabled { opacity: 0.6; cursor: not-allowed; }
        .submit-btn { background: linear-gradient(135deg, var(--primary) 0%, #4f46e5 100%); color: white; border: none; padding: 18px 30px; border-radius: 16px; font-size: 18px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 15px; box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.5); font-family: 'Outfit', sans-serif; }
        .submit-btn:disabled { background: #334155; box-shadow: none; cursor: not-allowed; }
        
        /* Badges */
        .difficulty-badge { padding: 6px 16px; border-radius: 50px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
        .difficulty-easy { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        .difficulty-medium { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .difficulty-hard { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }

        /* Feedback Overlay */
        .feedback-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; text-align: center; padding: 20px; }
        .feedback-overlay.active { opacity: 1; pointer-events: auto; }
        .feedback-icon { font-size: 60px; margin-bottom: 15px; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .feedback-title { font-family: 'Outfit', sans-serif; font-size: 28px; font-weight: 700; margin-bottom: 10px; color: white; }
        .feedback-message { color: var(--text-muted); font-size: 16px; max-width: 80%; margin-bottom: 20px; }
        .points-pill { padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 18px; display: flex; align-items: center; gap: 8px; box-shadow: 0 10px 20px -5px rgba(0,0,0,0.3); }
        .feedback-success .feedback-icon { color: var(--success); }
        .feedback-success .points-pill { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid var(--success); }
        .feedback-error .feedback-icon { color: var(--danger); }
        .feedback-error .points-pill { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid var(--danger); }
        
        /* --- NEW REWARDS & RECOMMENDATIONS STYLES --- */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; text-align: left; }
        .reward-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; border: 1px solid var(--glass-border); text-align: center; }
        .medal-icon { font-size: 50px; margin-bottom: 10px; filter: drop-shadow(0 0 15px rgba(251, 191, 36, 0.5)); }
        .reward-title { font-size: 14px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .reward-value { font-size: 24px; font-weight: 800; color: var(--text-main); font-family: 'Outfit', sans-serif; margin-top: 5px; }
        .penalty-text { color: var(--danger); }
        
        .rec-container { margin-top: 30px; text-align: left; }
        .rec-header { font-size: 18px; font-weight: 700; margin-bottom: 15px; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .rec-list { display: grid; gap: 10px; }
        .rec-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center; transition: 0.3s; cursor: pointer; }
        .rec-item:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .rec-title { font-weight: 600; font-size: 14px; }
        .rec-tag { font-size: 10px; padding: 3px 8px; border-radius: 4px; background: rgba(255,255,255,0.1); text-transform: uppercase; }
        .rec-item.hard { border-left-color: var(--danger); }
        .rec-item.medium { border-left-color: var(--gold); }
        .rec-item.easy { border-left-color: var(--success); }

        /* Sidebar */
        .profile-header { font-family: 'Outfit', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border); }
        .profile-item { display: flex; justify-content: space-between; margin-bottom: 18px; }
        .profile-label { color: var(--text-muted); font-size: 14px; }
        .profile-value { font-weight: 600; font-family: 'Outfit', sans-serif; }
        .performance-badge { padding: 5px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .performance-developing { background: rgba(245, 158, 11, 0.1); color: #fbbf24; }
        .performance-high { background: rgba(16, 185, 129, 0.1); color: #34d399; }
        .performance-low { background: rgba(239, 68, 68, 0.1); color: #f87171; }
        .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); width: 0%; transition: width 1s ease; }
        
        .hidden { display: none; }
        .restart-btn { background: transparent; border: 2px solid var(--accent); color: var(--accent); padding: 15px 40px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; margin-top: 30px; }
        .restart-btn:hover { background: var(--accent); color: #000; }
        
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } .navbar { flex-direction: column; } .results-grid { grid-template-columns: 1fr; } }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="navbar-brand">
            <img src="https://tse2.mm.bing.net/th/id/OIP.rP82H83lGpREE0CMygAN1gHaHa?rs=1&pid=ImgDetMain&o=7&rm=3" alt="Logo">
            <span>Cognitive AI</span>
        </div>
    </div>

    <div class="container">
        <div class="quiz-section">
            <div class="card-style quiz-box" id="quiz-box">
                <div class="feedback-overlay" id="feedback-overlay">
                    <div class="feedback-icon" id="feedback-icon">âœ…</div>
                    <div class="feedback-title" id="feedback-title">Correct!</div>
                    <div class="feedback-message" id="feedback-message">Great job keeping up the pace.</div>
                    <div class="points-pill" id="feedback-points">+ 10 Points</div>
                </div>

                <div class="quiz-header">
                    <div class="quiz-title">Adaptive Assessment</div>
                    <div class="quiz-subtitle">Question <span id="q-number">1</span>/15</div>
                </div>

                <div class="meta-info">
                    <div class="difficulty-badge" id="difficulty-badge">Easy</div>
                    <div class="timer" id="timer">30s</div>
                </div>

                <div class="question" id="question">Loading Question...</div>

                <div class="options-container" id="options-container">
                    <div class="option" onclick="selectAnswer(this, 'A')"><div class="option-text">A) </div></div>
                    <div class="option" onclick="selectAnswer(this, 'B')"><div class="option-text">B) </div></div>
                    <div class="option" onclick="selectAnswer(this, 'C')"><div class="option-text">C) </div></div>
                    <div class="option" onclick="selectAnswer(this, 'D')"><div class="option-text">D) </div></div>
                </div>

                <button class="submit-btn" onclick="submitAnswer()" id="submit-btn">Confirm Answer</button>
            </div>

            <div class="card-style results-section hidden" id="results-section" style="text-align: center;">
                <div class="quiz-title">Assessment Report</div>
                
                <div style="font-size: 60px; font-weight: 800; font-family: 'Outfit', sans-serif; margin: 10px 0; color: var(--text-main);">
                    <span id="final-score">0</span><span style="font-size: 30px; color: var(--text-muted);">/15</span>
                </div>

                <div class="results-grid">
                    <div class="reward-card">
                        <div class="medal-icon" id="reward-medal">ðŸ¥‡</div>
                        <div class="reward-title">Earned Status</div>
                        <div class="reward-value" id="reward-status">Elite</div>
                    </div>
                    <div class="reward-card">
                        <div class="medal-icon" id="xp-icon">âœ¨</div>
                        <div class="reward-title">Total XP</div>
                        <div class="reward-value" id="reward-xp">0 XP</div>
                    </div>
                </div>

                <div class="rec-container">
                    <div class="rec-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                        AI-Recommended Practice
                    </div>
                    <div id="rec-list" class="rec-list">
                        </div>
                </div>

                <button class="restart-btn" onclick="restartQuiz()">Start New Session</button>
            </div>
        </div>

        <div class="card-style profile-section">
            <div class="profile-header">Live Analytics</div>
            <div class="profile-info">
                <div class="profile-item">
                    <span class="profile-label">System ID</span>
                    <span class="profile-value" id="student-id" style="color: var(--accent);">#4217</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Current Score</span>
                    <span class="profile-value" id="display-score">0</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Next Difficulty</span>
                    <span class="profile-value" id="next-difficulty-label" style="text-transform: capitalize;">Easy</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Avg. Latency</span>
                    <span class="profile-value" id="response-time">0.0s</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Current Level</span>
                    <span class="performance-badge performance-developing" id="performance-level">DEVELOPING</span>
                </div>
            </div>
            <div class="progress-container">
                <div class="profile-item" style="margin-bottom: 5px;">
                    <span class="profile-label">Mastery Progress</span>
                    <span class="profile-value" id="progress-percent">0%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            </div>
        </div>
    </div>

    <script src="questionBank.js"></script>

    <script>
        // --- Game Config ---
        const MAX_QUESTIONS = 15;
        const TIME_PER_QUESTION = 30;

        // --- State Variables ---
        let currentQuestionObj = null;
        let usedQuestionIds = [];
        let currentQuestionCount = 0;
        let startTime = Date.now();
        let selectedOption = null;
        let timerInterval;
        let isTimeUp = false;
        let correctCount = 0;
        let totalPoints = 0; // Gamified XP
        let responseTimes = [];
        let currentDifficulty = "easy"; 

        // --- Recommendation Data ---
        const practiceModules = {
            remedial: [
                { title: "Basic Arithmetic Review", tag: "Foundations" },
                { title: "Understanding Number Patterns", tag: "Logic" },
                { title: "Introduction to Geometry", tag: "Shapes" }
            ],
            core: [
                { title: "Intermediate Algebra", tag: "Algebra" },
                { title: "Speed Math Techniques", tag: "Mental Math" },
                { title: "Probability Basics", tag: "Stats" }
            ],
            advanced: [
                { title: "Calculus: Derivatives", tag: "Calculus" },
                { title: "Complex Logic Puzzles", tag: "Advanced Logic" },
                { title: "Binary & Hexadecimal Systems", tag: "Comp Sci" }
            ]
        };

        // --- Adaptive Logic ---
        function getNextDifficulty(wasCorrect) {
            if (wasCorrect) {
                if (currentDifficulty === "easy") return "medium";
                if (currentDifficulty === "medium") return "hard";
                return "hard";
            } else {
                if (currentDifficulty === "hard") return "medium";
                if (currentDifficulty === "medium") return "easy";
                return "easy";
            }
        }

        function getRandomQuestion(difficulty) {
            let available = questionBank.filter(q => q.difficulty === difficulty && !usedQuestionIds.includes(q.id));
            if (available.length === 0) available = questionBank.filter(q => !usedQuestionIds.includes(q.id));
            if (available.length === 0) return null;
            return available[Math.floor(Math.random() * available.length)];
        }

        // --- Core Quiz Functions ---
        function initQuiz() {
            currentQuestionCount = 0;
            correctCount = 0;
            totalPoints = 0;
            usedQuestionIds = [];
            responseTimes = [];
            currentDifficulty = "easy";
            
            document.getElementById('quiz-box').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
            
            loadNextQuestion();
            updateProfileDisplay();
        }

        function loadNextQuestion() {
            if (currentQuestionCount >= MAX_QUESTIONS) {
                showResults();
                return;
            }

            currentQuestionObj = getRandomQuestion(currentDifficulty);
            if (!currentQuestionObj) { showResults(); return; }

            usedQuestionIds.push(currentQuestionObj.id);
            currentQuestionCount++;

            document.getElementById('q-number').textContent = currentQuestionCount;
            document.getElementById('question').textContent = currentQuestionObj.question;
            
            const diffBadge = document.getElementById('difficulty-badge');
            diffBadge.textContent = currentDifficulty;
            diffBadge.className = 'difficulty-badge difficulty-' + currentDifficulty;
            document.getElementById('next-difficulty-label').textContent = currentDifficulty;

            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                option.querySelector('.option-text').textContent = currentQuestionObj.options[index];
                option.classList.remove('selected', 'disabled');
                option.onclick = () => selectAnswer(option, String.fromCharCode(65 + index));
            });

            startTime = Date.now();
            selectedOption = null;
            isTimeUp = false;
            document.getElementById('submit-btn').disabled = false;
            const timerElement = document.getElementById('timer');
            timerElement.classList.remove('warning');
            timerElement.textContent = `${TIME_PER_QUESTION}s`;
            document.getElementById('feedback-overlay').classList.remove('active', 'feedback-success', 'feedback-error');

            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = TIME_PER_QUESTION - elapsed;
            if (remaining <= 0) { clearInterval(timerInterval); timeUp(); return; }
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${remaining}s`;
            if (remaining <= 10) timerElement.classList.add('warning');
        }

        function selectAnswer(element, answer) {
            if (isTimeUp) return;
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedOption = answer;
        }

        function submitAnswer() {
            if (isTimeUp) return;
            if (!selectedOption) {
                const btn = document.getElementById('submit-btn');
                btn.innerText = 'Select an Option!';
                setTimeout(() => btn.innerText = 'Confirm Answer', 1000);
                return;
            }

            const time = Math.floor((Date.now() - startTime) / 1000);
            responseTimes.push(time);
            const isCorrect = selectedOption === currentQuestionObj.correct;

            if (isCorrect) {
                correctCount++;
                let pts = currentDifficulty === 'hard' ? 20 : (currentDifficulty === 'medium' ? 15 : 10);
                totalPoints += pts;
                showFeedbackOverlay(true, `Correct! Moving to ${getNextDifficulty(true)} questions.`, pts);
                currentDifficulty = getNextDifficulty(true);
            } else {
                let pts = 2;
                totalPoints = Math.max(0, totalPoints - pts);
                showFeedbackOverlay(false, `Answer: ${currentQuestionObj.correct}. Moving to ${getNextDifficulty(false)} questions.`, -pts);
                currentDifficulty = getNextDifficulty(false);
            }
            finishQuestionInteraction();
        }

        function timeUp() {
            isTimeUp = true;
            responseTimes.push(TIME_PER_QUESTION);
            showFeedbackOverlay(false, "Time Limit Exceeded", 0, true);
            currentDifficulty = getNextDifficulty(false);
            finishQuestionInteraction();
        }

        function showFeedbackOverlay(isSuccess, message, pointsChange, isTimeout = false) {
            const overlay = document.getElementById('feedback-overlay');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');
            const pts = document.getElementById('feedback-points');

            overlay.className = 'feedback-overlay active';
            if (isSuccess) {
                overlay.classList.add('feedback-success');
                icon.textContent = 'âœ…'; title.textContent = 'Awesome!'; pts.textContent = `+ ${pointsChange} Points`;
            } else {
                overlay.classList.add('feedback-error');
                icon.textContent = isTimeout ? 'â°' : 'ðŸ“‰'; title.textContent = isTimeout ? 'Time Up!' : 'Adjusting Path';
                pts.textContent = pointsChange === 0 ? '0 Points' : `${pointsChange} Points`;
            }
            msg.textContent = message;
            setTimeout(loadNextQuestion, 2000);
        }

        function finishQuestionInteraction() {
            document.querySelectorAll('.option').forEach(opt => { opt.classList.add('disabled'); opt.onclick = null; });
            document.getElementById('submit-btn').disabled = true;
            clearInterval(timerInterval);
            updateProfileDisplay();
        }

        // --- RESULTS & RECOMMENDATION LOGIC ---
        function showResults() {
            document.getElementById('quiz-box').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            const accuracy = (correctCount / MAX_QUESTIONS) * 100;
            document.getElementById('final-score').textContent = correctCount;
            
            // 1. Determine Rewards & Status (With Penalties)
            const medalIcon = document.getElementById('reward-medal');
            const statusText = document.getElementById('reward-status');
            const xpText = document.getElementById('reward-xp');
            let recs = [];

            if (accuracy >= 80) {
                // High Performance
                medalIcon.textContent = "ðŸ†";
                statusText.textContent = "Grandmaster";
                statusText.className = "reward-value"; // Reset class
                xpText.textContent = `${totalPoints} XP`;
                recs = practiceModules.advanced;
            } else if (accuracy >= 50) {
                // Medium Performance
                medalIcon.textContent = "ðŸ¥ˆ";
                statusText.textContent = "Apprentice";
                statusText.className = "reward-value";
                xpText.textContent = `${totalPoints} XP`;
                recs = practiceModules.core;
            } else {
                // Low Performance (Penalty)
                medalIcon.textContent = "âš ï¸";
                statusText.textContent = "Probation";
                statusText.className = "reward-value penalty-text"; // Red text
                // Penalty: Cap points or reduce them
                let penalizedPoints = Math.floor(totalPoints * 0.8); 
                xpText.textContent = `${penalizedPoints} XP (Reduced)`;
                recs = practiceModules.remedial;
            }

            // 2. Populate Recommendations
            const list = document.getElementById('rec-list');
            list.innerHTML = ''; // Clear old items
            
            recs.forEach(item => {
                const div = document.createElement('div');
                // Style border based on type
                let typeClass = accuracy >= 80 ? 'hard' : (accuracy >= 50 ? 'medium' : 'easy');
                div.className = `rec-item ${typeClass}`;
                div.innerHTML = `
                    <span class="rec-title">${item.title}</span>
                    <span class="rec-tag">${item.tag}</span>
                `;
                list.appendChild(div);
            });
        }

        function updateProfileDisplay() {
            const avgTime = responseTimes.length ? (responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length) : 0;
            document.getElementById('display-score').textContent = totalPoints;
            document.getElementById('response-time').textContent = `${avgTime.toFixed(1)}s`;
            const percentage = Math.min(100, (totalPoints / 300) * 100);
            document.getElementById('progress-percent').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('progress-fill').style.width = `${percentage}%`;

            const performanceElement = document.getElementById('performance-level');
            if (totalPoints > 150) { performanceElement.textContent = "HIGH"; performanceElement.className = 'performance-badge performance-high'; }
            else if (totalPoints > 50) { performanceElement.textContent = "DEVELOPING"; performanceElement.className = 'performance-badge performance-developing'; }
            else { performanceElement.textContent = "LOW"; performanceElement.className = 'performance-badge performance-low'; }
        }

        function restartQuiz() { initQuiz(); }

        window.onload = initQuiz;
    </script>
</body>
</html>